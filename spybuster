#!/bin/bash

# Default settings = 20
threads=20


while getopts "u:w:f:c:" opt; do
    case $opt in
        u) URL="$OPTARG" ;;
        w) WORDLIST="$OPTARG" ;;
        f) FILTER="$OPTARG" ;;
        c) CONCURRENCY="$OPTARG" ;;
        *) echo "Usage: $0 -u <url> -w <wordlist> [-f <status>] [-c <threads>]" >&2; exit 1 ;;
    esac
done


[[ -z "$URL" || -z "$WORDLIST" ]] && { echo "Error: -u and -w are required" >&2; exit 1; }
[[ ! -f "$WORDLIST" ]] && { echo "Error: Wordlist '$WORDLIST' not found" >&2; exit 1; }


[[ "${URL: -1}" != "/" ]] && URL="${URL}/"


echo "==========================================="
echo " Target     : $URL"
echo " Wordlist   : $(wc -l < "$WORDLIST") words"
echo " Threads    : $CONCURRENCY"
[[ -n "$FILTER" ]] && echo " Filter     : status code $FILTER"
echo "==========================================="
echo "[*] Starting directory brute-force..."


export URL FILTER
cat "$WORDLIST" | xargs -P "$threads" -I{} bash -c '
    path="{}"
    full_url="${URL}${path}"
    status=$(curl --connect-timeout 10 -o /dev/null -s -w "%{http_code}" "$full_url" 2>/dev/null || echo "000")

    case "$status" in
        200) color="\e[1;32m" ;;
        301|302|307|308) color="\e[1;35m" ;;
        403) color="\e[1;33m" ;;
        404) color="\e[1;31m" ;;   
        000) color="\e[1;33m"; status="NO RESPONSE" ;;
        *)   color="\e[1;34m" ;;
    esac

    if [[ -z "$FILTER" || "$status" == "$FILTER" || ("$status" == "NO RESPONSE" && "$FILTER" == "000") ]]; then
        echo -e "[${color}$status\e[0m] $full_url"
    fi
'

echo "[*] Done !"
